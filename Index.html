<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Puter Ultimate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Puter.js -->
  <script src="https://js.puter.com/v2/"></script>
</head>

<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">

    function App() {
      const [user, setUser] = React.useState(null);
      const [input, setInput] = React.useState("");
      const [chat, setChat] = React.useState([]);
      const [model, setModel] = React.useState("gpt-4o");

      React.useEffect(() => {
        puter.auth.getCurrentUser?.().then(setUser);
      }, []);

      async function login() {
        const u = await puter.auth.signInWithPopup();
        setUser(u);
      }

      async function send() {
        if (!input) return;
        const msg = { role: "user", text: input };
        setChat(c => [...c, msg]);

        const res = await puter.ai.chat({
          model,
          messages: [...chat, msg].map(m => ({
            role: m.role,
            content: m.text
          }))
        });

        setChat(c => [...c, { role: "assistant", text: res.text }]);
        setInput("");
      }

      return (
        <div className="max-w-3xl mx-auto p-4">
          <h1 className="text-2xl font-bold mb-4">
            Puter Ultimate
          </h1>

          {!user ? (
            <button onClick={login} className="bg-blue-600 text-white px-4 py-2 rounded">
              Sign in with Puter
            </button>
          ) : (
            <p className="text-sm mb-3">Logged in as {user.email}</p>
          )}

          <select value={model} onChange={e => setModel(e.target.value)}
            className="border p-2 rounded mb-3 w-full">
            <option value="gpt-4o">GPT-4o</option>
            <option value="claude-3.7">Claude</option>
            <option value="gemini-3.5">Gemini</option>
            <option value="stable-diffusion">Stable Diffusion</option>
          </select>

          <div className="border rounded p-3 h-80 overflow-auto bg-white mb-3">
            {chat.map((m, i) => (
              <div key={i} className={m.role === "user" ? "text-right" : ""}>
                <div className={`inline-block p-2 rounded mb-2 ${
                  m.role === "user" ? "bg-blue-600 text-white" : "bg-gray-200"
                }`}>
                  {m.text}
                </div>
              </div>
            ))}
          </div>

          <div className="flex gap-2">
            <input
              value={input}
              onChange={e => setInput(e.target.value)}
              className="flex-1 border p-2 rounded"
              placeholder="Ask anything..."
            />
            <button onClick={send} className="bg-blue-700 text-white px-4 rounded">
              Send
            </button>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);

  </script>
</body>
</html>
